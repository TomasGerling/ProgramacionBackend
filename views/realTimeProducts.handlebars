<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Real Time Products</title>
</head>
<body>
	<h1>Real Time Products</h1>
<img src="../../public/img/logo_ch.png" alt="Mi imagen">
	<div id="productsList">
		{{#each products}}
			<div class="product">
				<h2>{{this.name}}</h2>
				<p>{{this.price}}</p>
				<form action="" method="post">
					<button type="submit" name="delete" value="{{this.id}}">Delete</button>
				</form>
			</div>
		{{/each}}
	</div>

	<form id="addProductForm" method="post">
		<label for="productName">Product name:</label>
		<input type="text" name="productName" id="productName">
		<label for="productPrice">Product price:</label>
		<input type="number" name="productPrice" id="productPrice">
		<button type="submit">Add product</button>
	</form>

	<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
	<script>
		const socket = io("http://localhost:4000/realTimeProducts");

		socket.on("productCreated", (product) => {
			const productHtml = `
				<div class="product">
					<h2>${product.name}</h2>
					<p>${product.price}</p>
					<form action="" method="post">
						<button type="submit" name="delete" value="${product.id}">Delete</button>
					</form>
				</div>
			`;
			document.getElementById("productsList").insertAdjacentHTML("beforeend", productHtml);
		});

		socket.on("productDeleted", (productId) => {
			document.querySelector(`[value="${productId}"]`).closest(".product").remove();
		});

		document.getElementById("addProductForm").addEventListener("submit", (event) => {
			event.preventDefault();
			const productName = document.getElementById("productName").value;
			const productPrice = document.getElementById("productPrice").value;
			socket.emit("createProduct", {name: productName, price: productPrice});
			document.getElementById("productName").value = "";
			document.getElementById("productPrice").value = "";
		});

		document.getElementById("productsList").addEventListener("submit", (event) => {
			if (event.target.tagName === "FORM" && event.target.delete) {
				event.preventDefault();
				const productId = event.target.delete.value;
				socket.emit("deleteProduct", productId);
			}
		});
	</script>
</body>
</html>
